--- WeakAura Strings ---
dyehpaGivvxsvbzuKItruELQcQzHQClLYUq0ViLenmujhtQqltjYZiLQPjjY1iLyBKsQ(MQcCosjL3PQ09KkTpsjHdkuTqHYdLQMOK0fLuBuPQpIk1iLk4KQk0kfYmvQCtbSte6NiyOcQLQe8uKAQKQRskL2QKO6RKssNvsyVk6VezWuhMWIfKhRKMSkDzrBwG(mQQrtuDAv51kHMTeUTeTBs(TkgUurlxHNlLPJY1rY2rfFxsugpPuCELOMVQI2p8SJt9jD5K(oPVt9j9916SqSSEQnSj9KwOwLFgHppfBsVREV(KwSYEhvBQpPFQhBQpPVhPvQg7uoJnPxPASt5KEBBdrBBWABlhWvUy8eHkYgSMkouWYfCsy2bwRCKfhXfweKLd4YZ9f8TkyVJQjdrBBBisqnesPIdzVCHsLfWDH)PJxX)xeTTTHOTn4(ZiHRCX4jcvKnynvjatKGoSobTTVdYq022gIeudHuQ4q2lpxxC)ze6DVPcUlCqrrl)Iib1qiLkoKXoTwGZv)vM8GfudHuQ4qg70Abo3A1v)vMWDH5IhmxFr022gI22G7pJeEpLAL9oQgSMQeGjsqhwNG223bziABBdrBBW7PuRS3rbZoWTuDHzYt4YS1e8tyH6c35i5KkgCqQbtEoGxLNRlsIOGuQv27OGfudHuQ4qgiBnb)ewtGS1e8tzicggg(fewqnesPIdzStRf4C1FLjm(SlmxWNbSGAiKsfhYyNwlW5wRU6VYCJ7KP)ktnYG1k6cZfmtEQqemmmmmmmmDQU9YfSazRj4NAcKTMGFss(dlyW)KKn24P4tg8mkfmn)FiUixk4ppyb1qiLkoKXoTwGZTwD1FL5g3jt)vMAKjJK8Vr(ZdwqnesPIdzVCHsLfY(Iiyyy4SOLicgggggggMov3E5cwGS1e8tnbYwtWpjj)j)5blOgcPuXHSxUqPYczFremmmCQUicgggwqnesPIdzV8CDX9NrO39Mk4UWSbv(frWWWWJKrnuFruQUt2KnPzJhF(5yQpPzl3zoPxPASt5K(sneS3rnP74Ko5KkwBs3tiqS46s7iWTuDLxtuxsBjU)J70RxOUkp4W7Ixr9csluZDnrPAIXJTRUkp4(oexxkan3sXRwLaXj9kvJDkLyl3zoPtoPInPxLNRloPtoPInPxPASt5KoiLAL9okyn1CsfJhC4rg8Pn8G7pLHeSAoPIXdwIhSepy6d1ynjkktEW0hQXAUVqWVXdwIhSep4QzJruuM8GRMn2(cb)gpyjEWs8GP7mlkikktzicgggEBdo2P1GdCUWHPkkG1FL5aUdc1Tihicggg(feUMtQyWD7c)33H46sbO5wkE1Qei(dlux4WJm4tBG72f(VAL(HfQlCJnEk(KbFQRM(tzibRMtQy8G)dR)ldMjpvicgggggggwqnesPIdzStRf4C1FLjCxy2rrvgkhAASXtXNSrfst)PmKGvZjvmEWvIhSwKj7lIGHHHHHHHfudHuQ4qg70Abo3A1v)vMWDH5oz6VYuJm4pmSGAiKsfhYyNwlW5Q)kZVicgggovxebdddVTbhEKCsfdoi1GjphW9YZ1fBicggg(feUMtQyWD7c)hEx8kQxqAHAURjkvtmESD1v)HzYtfIGHHHHHHHfudHuQ4q2lpxxC)ze6DVPcUlCqrrl)Iiyyy4uDremmm82gCyQIc4E556IWDqOUf5arWWWWVGWQddwqnesPIdzV8CDX9NrO39MkyH6cxnBmIIYewOUW0hQXAsuuMWc1fUA2yefLjm(Slm9HASMefLjSqDHvhgCJnEk(KbFQRM(tzibRMtQy8G)dxVWhju9J9)YGfQlSMgB8u8jd(uxn9NYqcwnNuX4b)lvnEG4Cx)ld(mGBSXtXNm4tD10Fkdjy1CsfJh8VuGpstxx9xMmyM8uHiyyyyyyy4Tn4WfILZbCCgtSUiIGHHHHHHHFbHd9yKHeQRg6d1yn3xi434b3tiqS467iWTeHyr196s6veUwk8U4vuVGmy8zxyUGfQlCOhJmKqD1unBS9fc(nEW9ecelU(ocClriwuDVUKEfHRLigUxgm(SlmxWm5PcrWWWWWWWWWWWWVGWn24P4tg8PUA6pLHeSAoPIXd(NwR(rIC)ldMjpvicgggggggggggggggwqnesPIdzGS1e8tn0hQXAsuuMKK)WDsvuKx4FsYQzJruuMKK)Wv2Jjhoof7ahNXeRl(l7lIGHHHHHHHHHHHHHHHhjJAO(Iiyyyyyyyyyyy4SOLicgggggggggggggggwqnesPIdzGS1e8tn0hQXAsuuMKK)WDsvuKx4FsYQzJruuMKK)Wv2Jjh(NKKUZSOGOOmL9frWWWWWWWWWWWWWWWWJKrnuFremmmmmmmmmmmCQUicgggggggEBdo25UmCyQIcebdddddddNfT8feo0JrgsOUAQMn2(cb)gp4EcbIfxFhbULielQUxxsVIW1sH3fVI6fKbJp7cZfSqDHd9yKHeQRg6d1yn3xi434b3tiqS467iWTeHyr196s6veUwIy4EzW4ZUWCbZKNkebdddddddddddlOgcPuXHmq2Ac(PMQzJruuMKK)WHo3LH7KQOiVW)KK0hQXAsuuMY(Iiyyyyyyyyyyy4rYOgQVicgggggggEBdoCYGJZyI1fremmmmmmmCw0Yxq4qpgziH6QH(qnwZ9fc(nEW9ecelU(ocClriwuDVUupbI6lqyNu4DXROEbzW4ZUWCblux4qpgziH6QPA2y7le8B8G7jeiwC9De4wIqSO6EDj9kcxlrmCVmy8zxyUGzYtfIGHHHHHHHHHHHfudHuQ4qgiBnb)ud9HASMefLjj5VMWjtgCNuff5f(NKSA2yefLPSVicgggggggggggEKmQH6lIGHHHHHHH32GdNm4yN7YWHPkkqemmmmmmmCw0Yxq4qpgziH6QH(qnwZ9fc(nEW9ecelU(ocClriwuDVUupbI6lqyNu4DXROEbzW4ZUWCblux4qpgziH6QH(qnwZ9fc(nEW9ecelU(ocClriwuDVUKEfHRLigUxgm(SlmxWm5PcrWWWWWWWWWWWWcQHqkvCidKTMGFQPA2yefLjj5VMWjtgCOZDz4oPkkYl8pjj9HASMefLPSVicgggggggggggEKmQH6lIGHHHHHHHt1frWWWWP6IOuDN0Run2Pus(7MtA2RmVt2KEK8FhL(YDMtAwQnSjDWHOmPzdbtmjU0KUYExM85(kPfU0Uwx7AVsAHRL0(hO10YsZGBAzPjDllcg(8uSj9U696tAfvP(4XNFoAtIDCs)UtATACP4jt(YnPWuffXvQdLAnhtA55JVC2CFL0cxAxRRDTxjTW1sA)d0AAzPzWnTS0KU4iUt9j99fm4BLQGT8uFsxsvWEt9jBYM0Jtro1N0LufS3uFYMSj9qSMt9jDjvb7n1NSjBsZefPIn1N0LufS3uFYMSjDqXk7Dut9jDjvb7n1NSjBYMSjDBsVezhj5ICPpysZzsSJvAPoozZj


--[[
Author : Aethys
Version : 1.0 (06.18.2016)
Readme :
    WeakAura that send a chat message to show who pulled and how far from the Pull Timer if there is one.
    You can customize the channel output in the init section.
]]--


--- Actions\On Init\Custom ---

-- Init
---
-- User Variables (You have to /reload after modifications)
---
aura_env.Channel = "SAY";
---
-- Core Variables (DO NOT TOUCH)
---
aura_env.CheckForbidden = false;
aura_env.BossModTime, aura_env.BossModEndTime = 0, 0;
---
-- Core Functions (DO NOT TOUCH)
---
-- Function to send the message and prevent further check.
function aura_env.Message (Message)
	if aura_env.BossModTime ~= 0 or aura_env.BossModEndTime-GetTime() >= 0 then
		SendChatMessage(Message.." at "..string.format("%0.2f", aura_env.BossModEndTime-GetTime()).."s.", aura_env.Channel);
	else
		SendChatMessage(Message..".", aura_env.Channel);
	end
	aura_env.CheckForbidden = true;
	return;
end


--- Trigger\Custom Trigger ---

-- Trigger [COMBAT_LOG_EVENT_UNFILTERED]

function (Event, Prefix, CombatEvent, _, _, SourceName, SourceFlags, _, _, DestName, DestFlags, _, _, SpellName)
	-- Boss Mod Pull Timer Handler
	if Event == "CHAT_MSG_ADDON" and Prefix == "D4" and string.find(CombatEvent, "PT") then
		aura_env.BossModTime = tonumber(string.sub(CombatEvent, 4, 5));
		aura_env.BossModEndTime = GetTime() + aura_env.BossModTime;
	end
	-- Prevent further Checks
	if Event == "PLAYER_REGEN_ENABLED" then
		aura_env.CheckForbidden = false;
	end
	-- Pull Check Handler
	if not aura_env.CheckForbidden and DestName and SourceName and DestName ~= SourceName and not string.find(CombatEvent, "PERIODIC") and (string.find(CombatEvent, "_DAMAGE") or string.find(CombatEvent, "_MISSED")) then
		-- Player Attack
		if bit.band(SourceFlags, COMBATLOG_OBJECT_TYPE_PLAYER) ~= 0 and bit.band(DestFlags, COMBATLOG_OBJECT_TYPE_NPC) ~= 0 then
			if string.find(CombatEvent, "SWING") then
				aura_env.Message(SourceName.." pulled "..DestName.." with Auto Attack");
				return;
			else
				aura_env.Message(SourceName.." pulled "..DestName.." with "..SpellName);
				return;
			end
		-- Body Pull
		elseif bit.band(DestFlags, COMBATLOG_OBJECT_TYPE_PLAYER) ~= 0 and bit.band(SourceFlags, COMBATLOG_OBJECT_TYPE_NPC) ~= 0 then
			aura_env.Message(DestName.." body pulled "..SourceName);
			return;
		-- Pet Attack
		elseif bit.band(SourceFlags, COMBATLOG_OBJECT_CONTROL_PLAYER) ~= 0 and bit.band(DestFlags, COMBATLOG_OBJECT_TYPE_NPC) ~= 0 then
			aura_env.Message(SourceName.."(Pet) pulled "..DestName);
			return;
		-- Pet Body Pull
		elseif bit.band(SourceFlags, COMBATLOG_OBJECT_CONTROL_PLAYER) ~= 0 and bit.band(SourceFlags, COMBATLOG_OBJECT_TYPE_NPC) ~= 0 then
			aura_env.Message(DestName.."(Pet) body pulled "..SourceName);
			return;
		end
	end
end