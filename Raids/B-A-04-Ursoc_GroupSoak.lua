--- WeakAura Strings ---
dOKKnaGiPsnkq6uG4vsrWSuP0TGuTlvLHPs1XuswMujptksttvLUMkK2Muu9niLACQQ6CQq5DQG5Pcr3JG2NkeoOuHfQsXdLkAIeWfjvzJeiFuj6KqYkfQzkfHUPQk2jPYpvHQHcPOLQK6Pk1uLsxLuvFfsjJLqLZsOQ3kvzUkb3vQQ9kXFvcnyQdd1IjLhRktwixw0MH4ZsHrRICAIEnbQzRWTvKDl43sA4QKJRIA5K8Cf10bUoO2Uue9DifmEcLZtiRhsHUVuu2p6YQsBzpv2rLDuPTSHdaLSrJuvAl7h8mOov2iWHhqwdqHWyAAAAvcGvbAGcozCgIkGYg)aYMmBvYgns1p1OSO7EzduYgnsvPTSbIUYY(bpdQtL9dEguNw8KmklBGCkJk7h8mOov2iWHhqwdqHWyAAAAvcGvbAGcopqtZ4mev2p4zqDc1RgkBe4WdiRbOqymnnn9O(Wd65RCmOfsVmb7RCmqfqQqxDS)RU)hcJPPPPh1hEqhLAWii6sXa6j2LuHbYAGwin6RoWyAAA6r9Hh0tyLGPfshKJdmMMMMEuF4b91alkvnXkAivhymnnn9O(Wd6RbwuQ2NHXQuhEkPfs3D3hymnnn9O(Wd6RbwuQ6uQEJuhEkPfs3D3hymnnn9O(WdAfoevNUPQPjshEkrlj4KaPgmccTq6U7(aJPPPPzmnnnnsvrlfU6w6Ljqh80svf(6NCslvZqHqhvzmnnnnnnn9O(Wd6aEkPfsVmbRXYO11zqQqfqQqLqoWyAAAAAAAAjcn0Ljynwg1IvnsaQqukg0aEkHqluiDxqObNYaJPPPPPPPPPPPPVgyrPQtP6nsD4PKwiDapLhymnnnnnnnDoMtjcn0Ljynwg1IvnsaQqukg0aEkHqluiDZHqdoLbgttttttttttttFnWIs1(mmwL6WtjTq6aEkpWyAAAAAAA6CmNseAO6hKabsnyeeOb8uEl9YeSVYXavaPcD1X(V6(FiqGqdoLbgttttttttttttRWHO60nvnnr6WtjAjbNei1GrqOfshWt5bgttttttttNHigttttNHigttttlrOHEnWIs1(mmwL6WtjTqH0D3nDvrFnWIsvNs1BK6WtjTqH0D3neAWPmWyAAAAAAAAvcGvb6E9qfaPcb)YfA7y9s9ArPBPGw3Xp6TG(OqFnwg1IvnsGm0a1RgwSF)Vp6)0FF969PnU63NX0000ziIX0000J6dpOtXUKkmqwd7ZWyvkqQbJGqlKEoh5dafTVLw)GeiqQbJGa9AGfLQ9zySk1HNYBPxMG9vogOcivORo2)v3)dbceA0PxMGw5ucfYbgttttpQp8Gof7sQWazn0Pu9gPaPgmccTq65CKpau0(wA9dsGaPgmcc0RbwuQ6uQEJuhEkVLEzc2x5yGkGuHU6y)xD)peiqOrNEzcALtjuihymnnnTeHgAk2LuHbYAOtP6nsbsnyee6JG(oDvrNIDjvyGSg2NHXQuGudgbH(iOVdHgCkdmMMMMMMMMwIqdnf7sQWaznSpdJvPaPgmcc9rsNIDjvyGSg6uQEJuGudgbbcn4ugymnnnnnnnnnnnTkbWQaDVEOcGuHGF5cTDSEPETO0TuqR74h9wqFuOVglJAXQgjqgAG6vdl2V)3hDx0FF969PnU63NX000000005yoLi0qtXUKkmqwd7ZWyvkqQbJGqFe0PyxsfgiRHoLQ3ifi1GrqGqdoLbgttttttttttttRsaSkq3RhQaivi4xUqBhRxQxlkDlf06o(rVf0hf6RXYOwSQrcKHgOE1WI97)9r3C6VVE9(0gx97ZyAAAAAAA6meXyAAA6meXyAAAAjcnufoevNUPQPjshEkrlj4KaPgmccTqH0D3neAWPmWyAAAAAAAAvcGvb6E9qfaPcb)YfA7y9s9ArPBPGw3Xp6TG(OqFnwg1IvnsGm0a1RgwSF)Vp6Mt)91R3N24QFFgttttNHigttttpQp8GwRQPjsC3Qv10ejEAH06hKa0SolbYAaQchIQt3u10ePdpLOLeCsGudgbbYbgttttpQp8GE(mmwLI7w65ZWyvkEAH06hKa0SolbYAa61alkv7ZWyvQdpLqoWyAAA6r9Hh0pP6nsXDl9tQEJu80cP1pibOzDwcK1a0RbwuQ6uQEJuhEkHCGX0000J6dpOJKZG9zySkJOfsF)aJPPPPJKZG9zySkJOfsdvRQPjsC0OtpFggRsXbHMnJUl6ManuTQMMiXtJo98zySkfpeA2m6UoWyAAA6r9Hh0rYzao8YBQAAIAR7ZWyvslKEcdo9HmQvf0i5myFggRYi2S7FhfYbgtttthjNb7ZWyvgrlKgQwvttK4OrN(jvVrkoi0Sz0Dr3eOHQv10ejEA0PFs1BKIhcnBgDxhymnnn9O(Wd6i5mahE5nvnnrT1oLQ3iPfspHbN(qg1QcAKCgSpdJvzeB29VJc5aJPPPPzmnnnTeHgAKCgGdV8MQMMO26(mmwL0hjDKCgGdV8MQMMO2ANs1BKqObNYaJPPPPPPPPvjawfO71dvaKke8lxOTJ1l1RfLULcADh)O3c6Jc91yzulw1ibYqduVAyX(9)(O7I(7RxVpTXv)(mMMMMohZjJPPPPPPPPvjawfO71dvaKke8lxOTJ1l1RfLULcADh)O3c6Jc91yzulw1ibYqduVAyX(9)(OBo93xVEFAJR(9zmnnnDgIyCgIk73P8j4Yg(kcdYY(bpdQtlceDLL9madGNlGY(ukBCcu0T6(9YEuXrL2YgGhzauAl7j4bqwAlGcOSZWRchaPsgv2R()7QYgEoxmdVkCaKkzu5MYosIGiFWdGOsBzpbpaYsBbuaLTQoYsBzpbpaYsBbuaLnc(bK1qPTSNGhazPTakGY(QjVa4rgaL2YEcEaKL2cOakBf(LL2YEcEaKL2cOakB45Cr0ynKOIkAfqzJudGTenMfDDDVSJKZxdSOna)e8CzRlfdqVRybx2QSHSgAfDLLT8vdL9ma)e8CN1aaldtzau2hx)2nkb0RSXrrsGSgWJfbkzJgPAU0waLTmQS1xnxF0Huma9UIfCzJgKrGtfDRUFVSf74iiZjOii0r7MU6FtxD07n9x0UP)B())fe0)9Fzl64iiZjOiOJ20vD9)3F)9)9M()(X(T5fe0)9OLDaEQvjB0ivZfDRk7za(j4z0SkdGY(MJ32E8FkGYEUS76RRVvF3l7MSOB1VDTQakfa

--[[
Author : Namo
Version : 0.1
Readme :
	Ursoc, annonce le prochain groupe de soak, les signes doivent être rond et carré
]]--

--- WA Sections ---

Trigger CustomIcon

function()
    local spell = GetSpellInfo(198108)
    local debuffNextExpiration = -1;
    local mark = nil;
    local playerLower;
    local playerSquareName = "";
    local playerTriangleName = "";
    local randomBobbyNameWithDebuff = "";
    
    for i=1, GetNumGroupMembers() do
        local name = GetRaidRosterInfo(i);
        if (GetRaidTargetIndex(name) == 4) then
            playerTriangleName = name;
        elseif (GetRaidTargetIndex(name) == 6) then
            playerSquareName = name;
        elseif (UnitDebuff(name, GetSpellInfo(198108))) then
            randomBobbyNameWithDebuff = name;
        end
    end
    if (playerSquareName == "" or playerTriangleName == "") then
        return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 9 ..[[.blp]]
    end
    local expirationSquareDebuff = select(7, UnitDebuff(playerSquareName, GetSpellInfo(198108))) - GetTime();
    local expirationTriangleDebuff = select(7, UnitDebuff(playerTriangleName, GetSpellInfo(198108))) - GetTime();
    if (expirationTriangleDebuff > 0 or expirationSquareDebuff > 0) then
        if (expirationSquareDebuff < expirationTriangleDebuff) then
            return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 4 ..[[.blp]]
        elseif (expirationSquareDebuff > expirationTriangleDebuff) then
            return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 2 ..[[.blp]]
        end
    end
    if (randomBobbyNameWithDebuff == "") then
        return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 2 ..[[.blp]]
    end
    local bobbyX,bobbyY = UnitPosition(randomBobbyNameWithDebuff);
    local squareX, squareY = UnitPosition(playerSquareName);
    local circleX, circleY = UnitPosition(playerTriangleName);
    local distSquared = 0;
    distSquared = (bobbyX - squareX) ^ 2 + (bobbyY - squareY) ^ 2;
    local distanceBobbyToSquare = math.floor(distSquared^0.5);
    distSquared = (bobbyX - circleX) ^ 2 + (bobbyY - circleY) ^ 2;
    local distanceBobbyToTriangle = math.floor(distSquared^0.5);
    
    if (distanceBobbyToSquare < distanceBobbyToTriangle) then
        return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 2 ..[[.blp]]
    else
        return [[Interface\TARGETINGFRAME\UI-RaidTargetingIcon_]].. 4 ..[[.blp]]
    end
end

